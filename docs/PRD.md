# PRD — 온누리 재고조사 웹앱 (onnuri-inven)

## 1) 목적
현장에서 빠르고 실수에 강한 방식으로 재고를 조회하고(목록/상세),
입고/출고를 기록하며(재고 조정), 신규 상품을 등록하고(기초 데이터 입력),
관리자가 사용자 권한/활성 상태를 관리할 수 있는 웹앱을 만든다.

핵심은 “속도”와 “사고 방지”다.
- 한 손 조작 기준의 모바일 UX
- 서버가 규칙을 강제(RPC, RLS)
- 불필요한 기능을 의도적으로 배제한다

## 2) 사용자 및 권한
### Staff
- 상품 조회(목록/상세)
- 재고 조정(입고/출고)
- 상품 등록
- 상품 비활성(아카이브) 처리

### Admin
- Staff의 모든 기능
- 사용자 활성/비활성 및 역할 관리
- 로그 조회(운영 점검)

권한/접근은 Supabase Auth + RLS 정책으로 강제한다. :contentReference[oaicite:1]{index=1}

## 3) 핵심 사용자 흐름
1) 로그인
2) 제품목록: 구역 필터 + 검색(토큰 AND)
3) 제품 상세 진입
4) 입고/출고 모달에서 “양수” 수량 입력
5) 서버 RPC로 재고 조정 및 로그 기록
6) 목록으로 복귀(필터 + 검색 상태 유지)

목록 상태 유지는 URL query params를 사용한다(스크롤 복원은 제외). :contentReference[oaicite:2]{index=2}

## 4) 범위 (v1)
### 필수 페이지
- 로그인 페이지
- 목록(홈) 페이지
- 상세 페이지
- 등록 페이지
- 관리자 페이지

### 필수 기능
- 로그인/세션 유지 및 접근 제어
- 구역(냉동1/냉동2/냉장/상온) 기반 필터
- 검색: 다중 토큰 AND + 구역 토큰 override
- 상세: 재고 표시 + 입고/출고(양수 입력)
- 재고 변경은 RPC `public.adjust_stock`로만 처리(직접 update 금지)
- 재고 변경 시 로그 기록
- 상품 등록 시 inventory row 생성(stock=0)
- 상품 비활성(archived_reason 필수)
- 관리자: 사용자 목록, active/role 관리, 로그 조회(간단)

## 5) 비범위 (의도적으로 하지 않는 것)
- 스크롤 위치 복원
- 상세에서 다음/이전 상품 이동
- 바코드/스캔
- 제품 속성 변경 이력(재고 변화 로그만 유지)
- 재고를 프론트에서 계산하거나 누적해 추정하는 로직
- “완전 삭제” UX(기본은 비활성 운영)

이 비범위 목록은 “사고를 줄이기 위한 설계 결정”이다. :contentReference[oaicite:3]{index=3}

## 6) UX/디자인 기준
- 전체 배경색: #F9F8F6 고정
- 모바일 우선, 터치 타깃 최소 44px
- 단순한 카드 기반 리스트, 재고 숫자는 크게
- 로딩: Skeleton
- 에러: 사용자 메시지는 짧게, 상세는 console.error

## 7) 데이터/백엔드 원칙
- Supabase (Auth + Postgres + RLS)
- RLS 활성화 및 정책으로 접근 제어
- 재고 변경은 RPC만 허용하고, 서버에서 0 미만을 차단
- 로그는 서버에서 강제 기록
- 환경 변수(.env.local)에 Supabase URL/ANON KEY 저장(리포지토리에 커밋 금지)

## 8) 성공 기준 (Acceptance Criteria)
### 기능
- 로그인 후 staff가 목록/상세 조회 가능
- staff가 입고/출고를 수행하면:
  - 재고가 정확히 반영되고
  - 0 미만 출고는 실패하며
  - 로그가 남는다
- 제품 등록 시:
  - 제품이 생성되고
  - inventory row가 생성(stock=0)된다
- 목록에서 필터 + 검색 상태가 URL로 유지되고,
  상세에서 목록으로 돌아오면 유지된다
- admin만 관리자 페이지 접근 가능
- admin이 사용자 active/role을 변경할 수 있다

### 안정성
- 재고 직접 update 경로가 없어야 한다(RPC만)
- 의도적 비범위 기능이 구현되지 않아야 한다

## 9) 릴리즈 원칙
- 한 번에 한 페이지/한 기능 슬라이스씩 구현한다
- 각 슬라이스 완료 시 최소 수동 테스트 체크리스트를 남긴다
- 요구사항 변경 시 SSOT를 먼저 업데이트한다 :contentReference[oaicite:4]{index=4}
